var Utils=Utils||{};Utils.isAndroid2=function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("android 2")>-1?!0:!1},Utils.isBlackBerry=function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("blackberry")>-1?!0:!1},Utils.isWindowsPhone=function(){return navigator.userAgent.match(/(windows phone)/i)?!0:!1},Utils.isiOS=function(){return navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1},Utils.canPlayh264=function(){var t=document.createElement("video");return t.canPlayType&&t.canPlayType("video/mp4").replace(/no/,"")?!0:!1},Utils.hexToRBG=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return console.log("yup!"),e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},Utils.isTouch=function(){return"ontouchstart"in window},Utils.pixelDensity=function(){var t=1;return void 0!==window.devicePixelRatio&&(t=window.devicePixelRatio),t},Utils.hasHistoryAPI=function(){return!(!window.history||!history.pushState)},Utils.validEmail=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)};var App=App||{};App.Main=function(t,e,i,s){"use strict";function o(t){this.navController={},this.options=t,this.options.port||(this.options.port=5001),i("document").ready(i.proxy(this.handleAppReady,this)),this.alertFallback=!1,("undefined"==typeof console||"undefined"==typeof console.log)&&(console={},console.log=this.alertFallback?function(t){alert(t)}:function(){})}return o.prototype={handleAppReady:function(){this.navController=new s.NavController(this.options.port),"ontouchstart"in e&&i("body").removeClass("no-touch")}},o}(window,document,jQuery,App,Utils),App.Column=function(t){function e(e){this.API=new App.API(e.api_port),this.at=new App.ActionTree,this.HTMLFactory=new App.HTMLFactory,this.index=e.index,this.element=null,this.active=!1,this.params=t.extend({},e.params),this.action=e.action,this.subaction=e.subaction,this.columnActions=e.columnActions,this.path=e.path,this.optionsOpen=!1,this.colName="#Column",this.width=340,this.childOptions=this.at.getActions(this.path),this.nodeName=e.nodeName,this.minTime=e.minTime,this.maxTime=e.maxTime,this.page=1,this.scrollPos=0,this.account=e.account,this.setupColumn(),this.API.getData(this.account,this.action,this.params,t.proxy(this.receivedData,this))}return e.prototype={setupColumn:function(){this.element=t("#template").clone(),t(this.element).hide(),t(this.element).attr("id","Column"+this.index),t(".columnContainer").append(this.element),this.colName=this.colName+this.index;var e=t(this.colName+" .results");e.empty(),t(this.colName+" .loader").hide(),t(this.colName+" .showMore").hide(),t(this.colName+" .searchFilter").on("change",t.proxy(this.searchFilter,this)),t(this.colName+" .showMore").on("click",t.proxy(this.getMoreRows,this)),"emails/meta"===this.action?t(this.colName+" .searchFilter").hide():t(this.colName+" .emailTitle").hide(),this.setColumnActions(),this.setFilterOptions(),0===this.index?t(this.colName+" a.closeButton").hide():t(this.colName+" a.closeButton").on("click",t.proxy(this.handleColumnClose,this))},handleColumnClose:function(){t(this).trigger("Closing",[this.index])},setColumnActions:function(){t(this.colName+" .searchFilter").empty();for(var e=0;e<this.columnActions.length;e++){var i=this.columnActions[e].split("-"),s="";0===e&&(s=" selected"),"contacts-right"==this.columnActions[e]&&(i[0]="Observers");var o='<option value="'+this.columnActions[e]+'" '+s+">"+i[0]+"</option>";t(this.colName+" .searchFilter").append(o)}},searchFilter:function(){delete this.params.page,this.page=1,this.setFilterOptions(),this.searchColumn()},setFilterOptions:function(){this.nodeName=t(this.colName+" .searchFilter").val();var e,i=this.nodeName.split("-"),s=i[0];t(this.colName+" .additionalOptions a").off("click"),"contacts"===s?(e=t("#template .searchOptionWidgets .contacts").clone(),t(this.colName+" .additionalOptions").empty(),t(this.colName+" .additionalOptions").append(e),t(this.colName+" .keyword").on("focus",t.proxy(this.searchFocus,this)),t(this.colName+" .keyword").on("blur",t.proxy(this.searchBlur,this)),this.params.rel&&t(this.colName+" .additionalOptions .relationship").remove()):"emails"===s?(e=t("#template .searchOptionWidgets .emails").clone(),t(this.colName+" .additionalOptions").empty(),t(this.colName+" .additionalOptions").append(e),t(this.colName+" .keyword").on("focus",t.proxy(this.searchFocus,this)),t(this.colName+" .keyword").on("blur",t.proxy(this.searchBlur,this))):"dates"===s?(console.log(i),i[1]&&"day"==i[1]?(t(this.colName+" .additionalOptions").empty(),t(this.colName+" .start_date_year").off("change")):(e=t("#template .searchOptionWidgets .dates").clone(),t(this.colName+" .additionalOptions").empty(),t(this.colName+" .additionalOptions").append(e),t(this.colName+" .start_date_year").on("change",t.proxy(this.searchColumn,this)))):"words"===s?(t(this.colName+" .additionalOptions").empty(),t(this.colName+" .keyword").on("focus",t.proxy(this.searchFocus,this)),t(this.colName+" .keyword").on("blur",t.proxy(this.searchBlur,this))):"cliques"===s?t(this.colName+" .additionalOptions").empty():"observers"===s&&t(this.colName+" .additionalOptions").empty(),t(this.colName+" .additionalOptions a").on("click",t.proxy(this.searchColumn,this))},searchColumn:function(){console.log("SEARCHING!",this.action,this.params),1==this.page&&(t(this.colName+" .loader").fadeIn(),t(this.colName+" .showMore").hide());var e=t.extend({},this.params);this.nodeName=t(this.colName+" .searchFilter").val();var i=this.nodeName.split("-");this.action!==this.nodeName&&(this.action=i[0]);var s="";if("contacts"==this.action)s=t(this.colName+" .additionalOptions .keyword").val(),""!==s&&"enter keyword"!==s?e.keyword=s:delete e.keyword,i[1],e.rel?t(this.colName+" .additionalOptions select.relationship").val()&&e.rel!=t(this.colName+" .additionalOptions select.relationship").val()&&(e.rel=t(this.colName+" .additionalOptions select.relationship").val()):e.rel=t(this.colName+" .additionalOptions select.relationship").val(),e.count&&delete e.count,e.start||delete e.end,"any"==e.rel&&delete e.rel,e.order="desc";else if("emails"==this.action)s=t(this.colName+" .additionalOptions .keyword").val(),""!==s&&"enter keyword"!==s&&s!==this.params.keyword?e.keyword=s:delete e.keyword,e.order="asc";else if("dates"==this.action)if("to"===i[1]&&i.pop(),i[1])e.order="asc",e.start=this.params.start,e.end=this.params.end,e.count=i[1];else{var o=t(this.colName+" .start_date_year").val();""!==o?(sd=new Date(o,0,1,0,0,0,0),e.year=o):delete e.year,e.count="MONTH"}else"observers"==this.action;t.isEmptyObject(e)||(e.limit=20,e.start||(e.start=this.params.start,e.start||delete e.end),this.page>1&&(e.page=this.page),this.updateAll(this.action,e),t(this).trigger("RefreshingData",[this.index,this.nodeName]),this.path[this.index+1]=this.nodeName,this.childOptions=this.at.getActions(this.path))},searchFocus:function(){var e=t(this.colName+" .keyword");e.removeClass("error"),"enter keyword"===e.val()&&e.val("")},searchBlur:function(){var e=t(this.colName+" .keyword");""===e.val()?e.val("enter keyword"):e.removeClass("error")},receivedData:function(e){var i=t(this.colName+" .results"),s={};t(this).trigger("DataReceived",[this.index]),"contacts"==this.action?s=e.contacts.contact:"dates"==this.action?s=e.dates.dates:"emails"==this.action?s=e.emails.email:"emails/meta"==this.action?s=e.emails.email:"words"==this.action?s=e.words.word:"cliques"==this.action?s=e:"observers"==this.action&&(s=e),1==this.page&&t(i).hide(),0===s.length&&1==this.page?i.append(this.HTMLFactory.generateNoResults()):"emails/meta"==this.action?this.renderEmails(s):this.renderRows(s),1==this.page&&t(i).fadeIn(),this.active?t(this).trigger("Updated"):(this.active=!0,t(this).trigger("Ready")),t(this.colName+" .loader").fadeOut(),t(this.colName+" .scrollContainer").scrollTop(this.scrollPos)},renderEmails:function(e){var i=t(this.colName+" .results");i.append(this.HTMLFactory.generateEmail(e,this.params)),t(this.colName).addClass("wider")},renderRows:function(e){for(var i=t(this.colName+" .results"),s=0,o=0;o<e.length;o++)i.append(this.HTMLFactory.generateRow(this.action,this.params,e[o]));var n=i.children(".resultContainer");for(o=0;o<n.length;o++){var a=parseInt(t(n[o]).children(".tally").text());a>s&&(s=a)}var l=0;for(o=0;o<n.length;o++){var r=parseInt(t(n[o]).children(".tally").text()),c=i.children(".resultContainer").eq(o).children(".bar"),h=t(this.element).width()-2*parseInt(t(c).css("left")),d=Math.round(r/s*h);t(c).css("width",d),t(n[o]).hasClass("on")&&(l=o),"emails"==this.action&&t(c).css("width",h)}l&&(i.children(".resultContainer").addClass("dim"),i.children(".resultContainer").eq(l).removeClass("dim")),count=0,t(this.colName+" .resultContainer").each(t.proxy(function(e,i){t(i).on("click",t.proxy(this.newColumnRequest,this,[count])),count++},this)),20==e.length?t(this.colName+" .showMore").fadeIn():t(this.colName+" .showMore").hide()},newColumnRequest:function(e){t(this.colName+" .resultContainer").removeClass("on");var i=t(this.colName+" .resultContainer").eq(e),s=i.children("input").val(),o=this.childOptions[0].split("-"),n="",a="",l=t(this.colName+" .additionalOptions select.relationship").val();n=o[0],o.length>1&&(a=o[1]);var r=t.extend({},this.params);if(delete r.keyword,delete r.count,delete r.page,delete r.order,"contacts"===n)"dates"==this.action?(r.start=s.split("-")[0],r.end=s.split("-")[1]):(r[a]=s,r.count="to",r.rel||(r.rel=l));else if("dates"===n){if("dates"==this.action){var c=new Date;c.setTime(1e3*s.split("-")[0]),r.year=c.getFullYear(),r.month=c.getMonth()+1}else"contacts"==this.action?this.params.left&&this.params.right?r.observer=s:this.params.left&&(r.right=s):"words"==this.action&&(r.word=s);r.count="month","day"==a&&(r.order="asc",r.count="day",a="")}else"emails"===n?(r.order="asc","dates"==this.action?(r.start=s.split("-")[0],r.end=s.split("-")[1]):"contacts"==this.action?this.params.left&&this.params.right?r.observer=s:this.params.left?r.right=s:r.left=s:"emails"==this.action?r.id=s:"words"===n&&(r.word=s)):"emails/meta"===n?(r.id=s,delete r.limit):"observers"==this.action||"words"===n&&("dates"==this.action?(r.start=s.split("-")[0],r.end=s.split("-")[1]):"contacts"==this.action?this.params.left&&this.params.right?r.observer=s:this.params.left&&(r.right=s):(r[a]=s,r.count="to",r.rel||(r.rel=l)));console.log(this.index,"P-A:",r,n),t(this.colName+" .resultContainer").addClass("dim"),i.removeClass("dim"),i.addClass("on"),i.children(".loading").fadeIn(100),t(this).trigger("NewColumn",[this.index,n,r,e])},getMoreRows:function(){t(this.colName+" .resultContainer").each(t.proxy(function(e,i){t(i).off("click")},this)),this.page++,this.searchColumn(),this.scrollPos=t(this.colName+" .scrollContainer").scrollTop()},removeHighlight:function(){t(this.colName+" .resultContainer").removeClass("dim"),t(this.colName+" .resultContainer").removeClass("on")},updateAll:function(e,i){this.action=e,this.params=t.extend({},i),this.params.page||this.clearData(),"emails/meta"==e&&this.clearData(),this.API.getData(this.account,this.action,this.params,t.proxy(this.receivedData,this))},clearData:function(){t(this.colName+" .noresults").remove(),t(this.colName+" .resultContainer").remove(),t(this.colName+" .emailContainer").remove()},destroy:function(){t(this.element).remove()}},e}(jQuery,document,window,Utils),App.ColumnController=function(t,e,i){function s(e,s){this.columns=[],this.activeColumn=-1,this.activeRow=-1,this.totalColWidth=0,this.path=["root"],this.at=new App.ActionTree,this.dateSettings={},this.account=e,this.api_port=s,t(i).resize(t.proxy(this.handleResize,this)),this.adjustColumnHeight(),t("#loader").fadeIn()}return s.prototype={setDates:function(e){this.dateSettings=e;var i=new Date(e.minTime),s=new Date(e.maxTime);t(".optionContainer.dates .year").empty(),t(".optionContainer.dates .year").append('<option value="">all</option>');for(var o=i.getFullYear();o<=s.getFullYear();o++)t(".optionContainer.dates .year").append('<option value="'+o+'">'+o+"</option>")},addColumn:function(e,i){var s=this.at.getActions(this.path);this.path.push(s[0]);var o=new App.Column({action:e,params:i,index:this.columns.length,path:this.path.slice(0),columnActions:s,nodeName:s[0],maxTime:this.dateSettings.maxTime,minTime:this.dateSettings.minTime,account:this.account,api_port:this.api_port});t(o).on("Ready",t.proxy(this.displayColumn,this,[this.columns.length])),t(o).on("Updated",t.proxy(this.updatedColumn,this)),t(o).on("NewColumn",t.proxy(this.newColumnRequest,this)),t(o).on("Closing",t.proxy(this.closingColumn,this)),t(o).on("DataReceived",t.proxy(this.columnDataRecieved,this)),t(o).on("RefreshingData",t.proxy(this.updatePath,this)),this.columns.push(o)},updatedColumn:function(){this.adjustColumnHeight()},updatePath:function(t,e,i){i!=this.path[e+1]&&(this.path[e+1]=i,this.columns.length>e&&this.removeColumns(e+1))},columnDataRecieved:function(e,i){i>0&&(t("#Column"+(i-1)+" .loading").hide(),t("#Column"+(i-1)+" .resultContainer").eq(this.activeRow).children(".arrow").fadeIn())},newColumnRequest:function(e,i,s,o,n){this.columns[i+1]?(this.columns.length>i+1&&(this.removeColumns(i+2),console.log("NEWCOL",i,s,o),this.path[i+2]!=s&&(s=this.columns[i+1].action,o.count=this.columns[i+1].params.count,this.columns[i+1].params.start&&!o.start&&(o.start=this.columns[i+1].params.start),this.columns[i+1].params.end&&!o.end&&(o.end=this.columns[i+1].params.end))),t(this.columns[i+1].colName+" .loader").fadeIn(),this.columns[i+1].updateAll(s,o)):this.addColumn(s,o),this.activeRow=n},displayColumn:function(e){var s=e[0];this.columns.length>0&&t("#loader").fadeOut();var o=this.columns[s].element,n=s*this.columns[s].width;this.totalColWidth+=this.columns[s].width,t(o).css("left",n-80),t(o).hide().fadeIn(300,t.proxy(function(){if(this.totalColWidth>t(i).width()){var e=this.totalColWidth-t(i).width();t(".columnContainer").animate({scrollLeft:e},300)}},this)),t(o).css("left",n),this.adjustColumnHeight(),this.activeColumn=s},removeColumns:function(t){if(this.columns.length>t)for(var e=100*(this.columns.length-t),i=this.columns.length-1;i>=t;i--)this.removeColumn(i,e-100*i),this.path.pop();t-1>=0&&this.columns[t-1].removeHighlight()},removeColumn:function(e,i){t(this.columns[e].element).delay(i).fadeOut(300,t.proxy(function(){this.columns[e].destroy(),this.columns.splice(e,1)},this))},closingColumn:function(t,e){this.removeColumns(e)},adjustColumnHeight:function(){var e=0,s=0;e=t(i).height()-t("header").outerHeight(),t(".columnContainer").css("height",e);var o=t(".column");t(".column").css("height","");for(var n=0;n<o.length;n++){t(o[n]).height()>s&&(s=t(o[n]).height());var a=e-t(o[n]).children(".colHeader").height()-2*parseInt(t(o[n]).children(".colHeader").css("padding-left"));t(o[n]).children(".scrollContainer").css("height",a)}e>s&&(s=e),t(".column").css("height",e)},handleResize:function(){this.adjustColumnHeight()},destroy:function(){this.removeColumns(0)}},s}(jQuery,document,window,Utils),App.HTMLFactory=function(t){function e(){console.log("HTML FACTORY INIT")}var i=[31,28,31,30,31,30,31,31,30,31,30,31],s=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.prototype={generateNoResults:function(){return noResults=t("#template .noresults").eq(0).clone(),noResults},generateColumn:function(){},generateRow:function(e,o,n){newRow=t("#template .resultContainer").eq(0).clone();t(newRow).children(".bar");if(t(newRow).children(".tally").text(n.count),"contacts"==e)t(newRow).find(".title span").text(n.name),t(newRow).find(".title i").addClass("fa-user"),t(newRow).children("input").val(n.email);else if("dates"==e){var a,l;"MONTH"===o.count.toUpperCase()?(a=new Date(n.year,n.month-1,1,0,0,0,0),l=new Date(n.year,n.month-1,i[n.month-1],23,59,59,0),t(newRow).find(".title>span").text(s[n.month-1]+", "+n.year)):"DAY"===o.count.toUpperCase()&&(a=new Date(n.year,n.month-1,n.day,0,0,0,0),l=new Date(n.year,n.month-1,n.day,23,59,59,999),t(newRow).find(".title>span").text(s[n.month-1]+" "+n.day+", "+n.year)),t(newRow).find(".title>i").addClass("fa-calendar"),t(newRow).children("input").val(a.getTime()/1e3+"-"+l.getTime()/1e3)}else if("emails"==e){var r=new Date;r.setTime(1e3*n.date.utc),t(newRow).find(".title>span").text(r.toLocaleTimeString()+" "+n.subject),t(newRow).children(".title").attr("title",n.subject),t(newRow).children("input").val(n.id),t(newRow).find(".title i").addClass("fa-envelope")}else"words"==e&&(t(newRow).find(".title span").text(n.word),t(newRow).find(".title i").addClass("fa-file-word-o"),t(newRow).children("input").val(n.word));return newRow},generateEmail:function(e,i){newEmail=t("#template .emailContainer").eq(0).clone();var s=new Date;if(s.setTime(1e3*e.date.utc),newEmail.children(".subjectContainer").text(e.subject),newEmail.children(".date").text(e.date.date),newEmail.find(".fromContainer .name").text(e.contacts.from[0].name),newEmail.find(".fromContainer .email").text(e.contacts.from[0].email),(e.contacts.from[0].email==i.left||e.contacts.from[0].email==i.right)&&newEmail.find(".fromContainer .contact").eq(0).addClass("found"),e.contacts.to)for(var o=0;o<e.contacts.to.length;o++)newEmail.children(".toContainer").append(this.generateContact(e.contacts.to[o])),(e.contacts.to[o].email==i.left||e.contacts.to[o].email==i.right)&&newEmail.find(".toContainer .contact").eq(o).addClass("found");if(e.contacts.cc)for(var n=0;n<e.contacts.cc.length;n++)newEmail.children(".ccContainer").append(this.generateContact(e.contacts.cc[n])),console.log(e.contacts.cc[n].email,i.observer),(e.contacts.cc[n].email==i.left||e.contacts.cc[n].email==i.right||e.contacts.cc[n].email==i.observer)&&newEmail.find(".ccContainer .contact").eq(n).addClass("found");else newEmail.children(".ccContainer").hide();if(e.contacts.bcc)for(var a=0;a<e.contacts.bcc.length;a++)newEmail.children(".bccContainer").append(this.generateContact(e.contacts.bcc[a])),(e.contacts.bcc[a].email==i.left||e.contacts.bcc[a].email==i.right||e.contacts.bcc[a].email==i.observer)&&newEmail.find(".bccContainer .contact").eq(a).addClass("found");else newEmail.children(".bccContainer").hide();return e.body&&newEmail.find(".bodyContainer .bodyContent").html(e.body.replace(/(?:\r\n|\r|\n)/g,"<br />")),newEmail},generateContact:function(e){var i=t("#template .emailContainer .contact").eq(0).clone();return"null"!==e.name?(i.children(".name").text(e.name),i.children(".email").text("<"+e.email+">")):(i.children(".name").text("<"+e.email+">"),i.children(".email").hide()),i},generateDIV:function(e,i){var s=t("<div></div>");if(e.length)for(var o=0;o<e.length;o++)s.addClass(e[o]);return s.html(i),s},destroy:function(){}},e}(jQuery,document,window,Utils),App.MinezyController=function(t,e,i,s){function o(e){console.log("MINEZY INIT"),this.accounts={},this.account=void 0,this.progressTimer=0,this.tmpcount=0,t(i).on("mediaQueryChange",t.proxy(this.handleMediaQueryChange,this)),t(i).resize(t.proxy(this.handleResize,this)),s.isTouch()?t(i).on("touchmove",t.proxy(this.handleScroll,this)):t(i).scroll(t.proxy(this.handleScroll,this)),this.dateSettings={},this.API=new App.API(e.port),this.APIport=e.port,this.account=100,this.API.getData(0,"accounts",{},t.proxy(this.checkAccount,this)),t(".info.about .button").on("click",t.proxy(this.showInfo,this))}return o.prototype={checkAccount:function(e){for(var i=e.accounts.account,s=0;s<i.length;s++)i[s].id==t.cookie("account")&&(this.account=t.cookie("account"));this.account>0?this.loadAccount():this.showSettings()},initAccounts:function(){t("#account_id").empty();for(var e=0;e<this.accounts.length;e++){var i="";this.account==this.accounts[e].id&&(i=" selected"),t("#account_id").append('<option value="'+this.accounts[e].id+'" '+i+">"+this.accounts[e].account+"</option>")}},showInfo:function(){t(".siteOverlay").fadeIn(500),setTimeout(t.proxy(function(){console.log("here"),t("section.admin.info").removeClass("hide")},this),100),t("section.admin.info .closeButton").on("click",t.proxy(this.hideInfo,this)),t("section.admin.info .button.ok").on("click",t.proxy(this.hideInfo,this))},showSettings:function(){t(".siteOverlay").fadeIn(500),setTimeout(t.proxy(function(){console.log("here"),t("section.admin").removeClass("hide")},this),100),t("section.admin .closeButton,section.admin .button.cancel").on("click",t.proxy(this.hideSettings,this)),t("section.admin .button.ok").on("click",t.proxy(this.saveSettings,this)),t("section.admin .filename").hide(),t(":file").change(t.proxy(function(e){t(".filename").fadeIn(),t(".filename>span").text(e.currentTarget.files[0].name),t(".button.ok>i").removeClass("fa-check"),t(".button.ok>i").addClass("fa-upload"),t(".button.ok>span").text("Upload"),t("select.databases").prop("disabled","disabled"),t(".dbSelect").addClass("disabled"),t("section.admin .button.ok").off("click"),t("section.admin .button.ok").on("click",t.proxy(this.uploadFile,this))},this)),this.API.getData(0,"accounts",{},t.proxy(this.getAccounts,this))},uploadFile:function(){t("section.admin .button.ok").off("click"),t("section.admin .button.ok").addClass("disabled"),t(".button.ok>span").text("Uploading"),t(".button.ok>i").removeClass("fa-upload"),t(".button.ok>i").addClass("fa-refresh"),t(".button.ok>i").addClass("rotating"),t("section.admin .progressBar").hide(),t("section.admin .progressBar").slideDown(),t("section.admin .progressBar>.bar").width(0),t("section.admin .progressBar>span").text("0%"),console.log(t("#uploadFile").ajaxForm()),t("#uploadFile").ajaxSubmit({beforeSend:function(){var e="0%";t("section.admin .progressBar>.bar").width(e),t("section.admin .progressBar>span").html(e),console.log("BEGIN UPLOAD")},uploadProgress:function(e,i,s,o){var n=o+"%";t("section.admin .progressBar>.bar").width(n),t("section.admin .progressBar>span").html(n),console.log(o)},success:function(){var e="100%";t("section.admin .progressBar>.bar").width(e),t("section.admin .progressBar>span").html(e)},complete:t.proxy(function(e){e.responseText&&(t("section.admin .progressBar>.bar").width(0),t("section.admin .progressBar>span").text("0%"),t(".button.ok>span").text("Processing"),this.API.getData(0,"new_account",{file:e.responseText},t.proxy(this.startProcessing,this)))},this)})},startProcessing:function(e){t.cookie("account",e.account,{expires:365,path:"/"}),this.account=e.account,this.tmpcount=0,this.progressTimer=setInterval(t.proxy(function(){this.API.getData(0,"new_account/progress",{},t.proxy(this.updateProcessingProgress,this))},this),1e3)},updateProcessingProgress:function(){var e=this.tmpcount+"%";t("section.admin .progressBar>.bar").width(e),t("section.admin .progressBar>span").html(e),100==this.tmpcount&&(clearInterval(this.progressTimer),this.API.getData(0,"accounts",{},t.proxy(this.getAccounts,this)),this.hideSettings()),this.tmpcount+=10},hideInfo:function(){t("section.admin.info .closeButton,section.admin .button.cancel").off("click"),t("section.admin.info .button.ok").off("click"),t("section.admin.info").addClass("hide"),setTimeout(t.proxy(function(){t(".siteOverlay").fadeOut(500),this.resetSettings()},this),300)},hideSettings:function(){t("section.admin .closeButton,section.admin .button.cancel").off("click"),t("section.admin .button.ok").off("click"),t("section.admin").addClass("hide"),t(":file").off("change"),setTimeout(t.proxy(function(){t(".siteOverlay").fadeOut(500),this.resetSettings()},this),300)},resetSettings:function(){t("section.admin .button.ok>i").removeClass(),t("section.admin .button.ok>i").addClass("fa fa-check"),t(".button.ok>span").text("OK"),t("section.admin .progressBar").slideUp(),t("section.admin select.databases").prop("disabled",!1),t("section.admin .dbSelect").removeClass("disabled")},saveSettings:function(){this.account=t("#account_id").val(),t.cookie("account",this.account,{expires:365,path:"/"}),this.hideSettings(),this.loadAccount()},getAccounts:function(t){this.accounts=t.accounts.account,this.initAccounts()},loadAccount:function(){this.colManager&&(this.colManager.destroy(),delete this.colManager),this.colManager=new App.ColumnController(this.account,this.APIport),this.API.getData(this.account,"dates/range",{},t.proxy(this.getDateRange,this))},getDateRange:function(t){var e=new Date(t.dates.range.first.year,t.dates.range.first.month,t.dates.range.first.day,0,0,0,0),i=new Date(t.dates.range.last.year,t.dates.range.last.month,t.dates.range.last.day,0,0,0,0);this.dateSettings.minTime=e.getTime(),this.dateSettings.maxTime=i.getTime(),this.colManager.setDates(this.dateSettings),this.colManager.addColumn("contacts",{limit:20})},handleScroll:function(){},handleResize:function(){},destroy:function(){}},o}(jQuery,document,window,Utils),App.NavController=function(t,e,i,s,o){"use strict";function n(t){console.log("NAV CONTROLLER INIT"),this.currentPage="",this.router=new o.Router,this.pageNotFound=!1,this.port=t,this.createRoutes(),this.pageController=this.loadController()}return n.prototype={createRoutes:function(){this.router.addRoutes([{path:"/enron|jebbush",controller:"MinezyController"}])},loadController:function(){t("#404").length&&(this.pageNotFound=!0);var e={};if(this.pageNotFound||(e=this.router.route()),e)return e.createController({port:this.port});throw new Error("Undefined route: "+i.location.pathname)},destroy:function(){}},n}(jQuery,document,window,App,Utils),App.API=function(t,e,i){function s(t){this.api_root="http://"+i.location.hostname+":"+t,this.api_version=1,this.current_call=null}return s.prototype={getData:function(e,i,s,o){this.current_call&&(this.current_call.abort(),delete this.current_call),this.current_call=t.ajax({type:"GET",url:this.constructURL(e,i,s),data:s,dataType:"json"}).done(t.proxy(function(t){o(t)},this))},constructURL:function(t,e){var i="";t&&(i=t+"/"),console.log(t,i,e);var s=this.api_root+"/"+this.api_version+"/"+i+e;return console.log(s),s},destroy:function(){}},s}(jQuery,document,window,Utils),App.ActionTree=function(){function t(){}var e={root:{contacts:{"contacts-left":{"dates-to":{"dates-day":{"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1},"contacts-right":{"dates-to":{"dates-day":{"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}},words:{"dates-day":{"emails-list":{"emails/meta":!1},"contacts-left":{"emails-list":{"emails/meta":!1}}},"emails-list":{"emails/meta":!1}}},words:{"dates-day":{"emails-list":{"emails/meta":!1},"contacts-left":{"emails-list":{"emails/meta":!1}}},"emails-list":{"emails/meta":!1}},dates:{"dates-day":{"emails-list":{"emails/meta":!1},"contacts-left":{"emails-list":{"emails/meta":!1}}},"contacts-left":{"dates-day":{"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1},"contacts-right":!1},"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}},dates:{contacts:{"contacts-left":{"dates-day":{"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1},"contacts-right":{"dates-day":{"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}}},"dates-day":{"contacts-left":{"emails-list":{"emails/meta":!1},"contacts-right":!1},"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}},"dates-day":{contacts:{"contacts-left":{"emails-list":{"emails/meta":!1},"contacts-right":!1},"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}}},words:{dates:{"dates-day":{"emails-list":{"emails/meta":!1},"contacts-left":{"emails-list":{"emails/meta":!1}}},"emails-list":{"emails/meta":!1}},"emails-list":{"emails/meta":!1}}}};return t.prototype={getActions:function(t){var i=t.slice(0),s=this.traverse(e,i),o=[];for(var n in s)o.push(n);return i=null,o},traverse:function(t,e){var i;return 1==e.length?t[e.shift()]:(i=e.shift(),this.traverse(t[i],e))},destroy:function(){}},t}(jQuery,document,window,Utils),Utils.Route=function(){"use strict";function t(t,e){this.path=t,this.controller=e}return t.prototype={match:function(t){var e=new RegExp("^/?"+this.path+"/?$"),i=t.match(e);return null!==i?!0:!1},createController:function(t){if("undefined"!=typeof App[this.controller])return new App[this.controller](t);throw new Error("Controller cannot be created! ("+this.controller+")")}},t}(),Utils.Router=function(t,e){"use strict";function i(t){this.options=t||{},this.routes=[]}return i.prototype={addRoute:function(t,i){var s=new e.Route(t,i);this.routes.push(s)},addRoutes:function(e){t.each(e,t.proxy(function(t,e){this.addRoute(e.path,e.controller)},this))},getManualRoute:function(e){var i=!1;return t.each(this.routes,function(t,s){s.controller===e&&(i=s)}),i},route:function(){var e=!1;return t.each(this.routes,function(t,i){i.match(window.location.pathname)&&!e&&(e=i)}),e}},i}(jQuery,Utils);