var  Utils=Utils||{};Utils.isAndroid2=function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("android 2")>-1){return true}return false};Utils.isBlackBerry=function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("blackberry")>-1){return true}return false};Utils.isWindowsPhone=function(){return navigator.userAgent.match(/(windows phone)/i)?true:false};Utils.isiOS=function(){return navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?true:false};Utils.canPlayh264=function(){var e=document.createElement("video"),t=false;if(e.canPlayType&&e.canPlayType("video/mp4").replace(/no/,"")){return true}return false};Utils.hexToRBG=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);console.log("yup!");return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null};Utils.isTouch=function(){return"ontouchstart"in window};Utils.pixelDensity=function(){var e=1;if(window.devicePixelRatio!==undefined)e=window.devicePixelRatio;return e};Utils.hasHistoryAPI=function(){return!!(window.history&&history.pushState)};Utils.validEmail=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)};var App=App||{};App.Main=function(e,t,n,r,i){"use strict";function s(){this.navController={};n("document").ready(n.proxy(this.handleAppReady,this));this.alertFallback=false;if(typeof console==="undefined"||typeof console.log==="undefined"){console={};if(this.alertFallback){console.log=function(e){alert(e)}}else{console.log=function(){}}}}s.prototype={handleAppReady:function(){this.navController=new r.NavController;if("ontouchstart"in t){n("body").removeClass("no-touch")}}};return s}(window,document,jQuery,App,Utils);App.Column=function(e,t,n,r){function i(t){this.API=new App.API;this.at=new App.ActionTree;this.HTMLFactory=new App.HTMLFactory;this.index=t.index;this.element=null;this.active=false;this.params=e.extend({},t.params);this.action=t.action;this.subaction=t.subaction;this.columnActions=t.columnActions;this.path=t.path;this.optionsOpen=false;this.colName="#Column";this.width=340;this.childOptions=this.at.getActions(this.path);this.nodeName=t.nodeName;this.minTime=t.minTime;this.maxTime=t.maxTime;this.page=1;this.scrollPos=0;this.account=t.account;this.setupColumn();this.API.getData(this.account,this.action,this.params,e.proxy(this.receivedData,this))}i.prototype={setupColumn:function(){this.element=e("#template").clone();e(this.element).hide();e(this.element).attr("id","Column"+this.index);e(".columnContainer").append(this.element);this.colName=this.colName+this.index;var t=e(this.colName+" .results");t.empty();e(this.colName+" .loader").hide();e(this.colName+" .showMore").hide();e(this.colName+" .searchFilter").on("change",e.proxy(this.searchFilter,this));e(this.colName+" .showMore").on("click",e.proxy(this.getMoreRows,this));if(this.action==="emails/meta"){e(this.colName+" .searchFilter").hide()}else{e(this.colName+" .emailTitle").hide()}this.setColumnActions();this.setFilterOptions();if(this.index===0){e(this.colName+" a.closeButton").hide()}else{e(this.colName+" a.closeButton").on("click",e.proxy(this.handleColumnClose,this))}},handleColumnClose:function(t){e(this).trigger("Closing",[this.index])},setColumnActions:function(){e(this.colName+" .searchFilter").empty();for(var t=0;t<this.columnActions.length;t++){var n=this.columnActions[t].split("-");var r="";if(t===0){r=" selected"}if(this.columnActions[t]=="contacts-right"){n[0]="Observers"}var i='<option value="'+this.columnActions[t]+'" '+r+">"+n[0]+"</option>";e(this.colName+" .searchFilter").append(i)}},searchFilter:function(){delete this.params.page;this.page=1;this.setFilterOptions();this.searchColumn()},setFilterOptions:function(){this.nodeName=e(this.colName+" .searchFilter").val();var t=this.nodeName.split("-");var n=t[0];var r;e(this.colName+" .additionalOptions a").off("click");if(n==="contacts"){r=e("#template .searchOptionWidgets .contacts").clone();e(this.colName+" .additionalOptions").empty();e(this.colName+" .additionalOptions").append(r);e(this.colName+" .keyword").on("focus",e.proxy(this.searchFocus,this));e(this.colName+" .keyword").on("blur",e.proxy(this.searchBlur,this));if(this.params.rel){e(this.colName+" .additionalOptions .relationship").remove()}}else if(n==="emails"){r=e("#template .searchOptionWidgets .emails").clone();e(this.colName+" .additionalOptions").empty();e(this.colName+" .additionalOptions").append(r);e(this.colName+" .keyword").on("focus",e.proxy(this.searchFocus,this));e(this.colName+" .keyword").on("blur",e.proxy(this.searchBlur,this))}else if(n==="dates"){console.log(t);if(!t[1]||t[1]!="day"){r=e("#template .searchOptionWidgets .dates").clone();e(this.colName+" .additionalOptions").empty();e(this.colName+" .additionalOptions").append(r);e(this.colName+" .start_date_year").on("change",e.proxy(this.searchColumn,this))}else{e(this.colName+" .additionalOptions").empty();e(this.colName+" .start_date_year").off("change")}}else if(n==="words"){e(this.colName+" .additionalOptions").empty()}else if(n==="cliques"){e(this.colName+" .additionalOptions").empty()}else if(n==="observers"){e(this.colName+" .additionalOptions").empty()}e(this.colName+" .additionalOptions a").on("click",e.proxy(this.searchColumn,this))},searchColumn:function(){console.log("SEARCHING!",this.action,this.params);if(this.page==1){e(this.colName+" .loader").fadeIn();e(this.colName+" .showMore").hide()}var t=e.extend({},this.params);this.nodeName=e(this.colName+" .searchFilter").val();var n=this.nodeName.split("-");if(this.action!==this.nodeName){this.action=n[0]}var r="";if(this.action=="contacts"){r=e(this.colName+" .additionalOptions .keyword").val();if(r!==""&&r!=="enter keyword"){t.keyword=r}else{delete t.keyword}if(n[1]){}else{}if(!t.rel){t.rel=e(this.colName+" .additionalOptions select.relationship").val()}else if(e(this.colName+" .additionalOptions select.relationship").val()){if(t.rel!=e(this.colName+" .additionalOptions select.relationship").val()){t.rel=e(this.colName+" .additionalOptions select.relationship").val()}}if(t.count)delete t.count;if(!t.start)delete t.end;if(t.rel=="any")delete t.rel;t.order="desc"}else if(this.action=="emails"){r=e(this.colName+" .additionalOptions .keyword").val();if(r!==""&&r!=="enter keyword"&&r!==this.params.keyword){t.keyword=r}else{delete t.keyword}t.order="asc"}else if(this.action=="dates"){if(n[1]==="to"){n.pop()}if(!n[1]){var i=e(this.colName+" .start_date_year").val();if(i!==""){sd=new Date(i,0,1,0,0,0,0);t.year=i}else{delete t.year}t.count="MONTH"}else{t.order="asc";t.start=this.params.start;t.end=this.params.end;t.count=n[1]}}else if(this.action=="observers"){}if(!e.isEmptyObject(t)){t.limit=20;if(!t.start){t.start=this.params.start;if(!t.start){delete t.end}}if(this.page>1){t.page=this.page}this.updateAll(this.action,t);e(this).trigger("RefreshingData",[this.index,this.nodeName]);this.path[this.index+1]=this.nodeName;this.childOptions=this.at.getActions(this.path)}},searchFocus:function(t){var n=e(this.colName+" .keyword");n.removeClass("error");if(n.val()==="enter keyword"){n.val("")}},searchBlur:function(t){var n=e(this.colName+" .keyword");if(n.val()===""){n.val("enter keyword")}else{n.removeClass("error")}},receivedData:function(t){var n=e(this.colName+" .results");var r={};var i=0;e(this).trigger("DataReceived",[this.index]);if(this.action=="contacts"){r=t.contacts.contact}else if(this.action=="dates"){r=t.dates.dates}else if(this.action=="emails"){r=t.emails.email}else if(this.action=="emails/meta"){r=t.emails.email}else if(this.action=="words"){r=t.words.word}else if(this.action=="cliques"){r=t}else if(this.action=="observers"){r=t}if(this.page==1)e(n).hide();if(r.length===0&&this.page==1){n.append(this.HTMLFactory.generateNoResults())}else{if(this.action=="emails/meta"){this.renderEmails(r)}else{this.renderRows(r)}}if(this.page==1)e(n).fadeIn();if(!this.active){this.active=true;e(this).trigger("Ready")}else{e(this).trigger("Updated")}e(this.colName+" .loader").fadeOut();e(this.colName+" .scrollContainer").scrollTop(this.scrollPos)},renderEmails:function(t){var n=e(this.colName+" .results");n.append(this.HTMLFactory.generateEmail(t,this.params));e(this.colName).addClass("wider")},renderRows:function(t){var n=e(this.colName+" .results");var r=0;for(var i=0;i<t.length;i++){n.append(this.HTMLFactory.generateRow(this.action,this.params,t[i]))}var s=n.children(".resultContainer");for(i=0;i<s.length;i++){var o=parseInt(e(s[i]).children(".tally").text());if(o>r)r=o}var u=0;for(i=0;i<s.length;i++){var a=parseInt(e(s[i]).children(".tally").text());var f=n.children(".resultContainer").eq(i).children(".bar");var l=e(this.element).width()-parseInt(e(f).css("left"))*2;var c=Math.round(a/r*l);e(f).css("width",c);if(e(s[i]).hasClass("on")){u=i}if(this.action=="emails"){e(f).css("width",l)}}if(u){n.children(".resultContainer").addClass("dim");n.children(".resultContainer").eq(u).removeClass("dim")}count=0;e(this.colName+" .resultContainer").each(e.proxy(function(t,n){e(n).on("click",e.proxy(this.newColumnRequest,this,[count]));count++},this));if(t.length==20){e(this.colName+" .showMore").fadeIn()}else{e(this.colName+" .showMore").hide()}},newColumnRequest:function(t,n){e(this.colName+" .resultContainer").removeClass("on");var r=e(this.colName+" .resultContainer").eq(t);var i=r.children("input").val();var s=this.childOptions[0].split("-");var o="";var u="";var a=e(this.colName+" .additionalOptions select.relationship").val();o=s[0];if(s.length>1){u=s[1]}var f=e.extend({},this.params);delete f.keyword;delete f.count;delete f.page;delete f.order;if(o==="contacts"){if(this.action=="dates"){f.start=i.split("-")[0];f.end=i.split("-")[1]}else{f[u]=i;f.count="to";if(!f.rel){f.rel=a}}}else if(o==="dates"){if(this.action=="dates"){var l=new Date;l.setTime(i.split("-")[0]*1e3);f.year=l.getFullYear();f.month=l.getMonth()+1}else if(this.action=="contacts"){if(this.params.left&&this.params.right)f.observer=i;else if(this.params.left){f.right=i}}else if(this.action=="words"){f.word=i}f.count="month";if(u=="day"){f.order="asc";f.count="day";u=""}}else if(o==="emails"){f.order="asc";if(this.action=="dates"){f.start=i.split("-")[0];f.end=i.split("-")[1]}else if(this.action=="contacts"){if(this.params.left&&this.params.right)f.observer=i;else if(this.params.left)f.right=i;else f.left=i}else if(this.action=="emails"){f.id=i}else if(this.action=="words"){f.word=i}}else if(o==="emails/meta"){f.id=i;delete f.limit}else if(this.action=="observers"){}else if(o==="words"){if(this.action=="dates"){f.start=i.split("-")[0];f.end=i.split("-")[1]}else if(this.action=="contacts"){if(this.params.left&&this.params.right)f.observer=i;else if(this.params.left){f.right=i}}else{f[u]=i;f.count="to";if(!f.rel){f.rel=a}}}console.log(this.index,"P-A:",f,o);e(this.colName+" .resultContainer").addClass("dim");r.removeClass("dim");r.addClass("on");r.children(".loading").fadeIn(100);e(this).trigger("NewColumn",[this.index,o,f,t])},getMoreRows:function(){e(this.colName+" .resultContainer").each(e.proxy(function(t,n){e(n).off("click")},this));this.page++;this.searchColumn();this.scrollPos=e(this.colName+" .scrollContainer").scrollTop()},removeHighlight:function(){e(this.colName+" .resultContainer").removeClass("dim");e(this.colName+" .resultContainer").removeClass("on")},updateAll:function(t,n){this.action=t;this.params=e.extend({},n);if(!this.params.page){this.clearData()}if(t=="emails/meta"){this.clearData()}this.API.getData(this.account,this.action,this.params,e.proxy(this.receivedData,this))},clearData:function(){e(this.colName+" .noresults").remove();e(this.colName+" .resultContainer").remove();e(this.colName+" .emailContainer").remove()},destroy:function(){e(this.element).remove()}};return i}(jQuery,document,window,Utils);App.ColumnController=function(e,t,n,r){function i(t){this.columns=[];this.activeColumn=-1;this.activeRow=-1;this.totalColWidth=0;this.path=["root"];this.at=new App.ActionTree;this.dateSettings={};this.account=t;e(n).resize(e.proxy(this.handleResize,this));this.adjustColumnHeight();e("#loader").fadeIn()}i.prototype={setDates:function(t){this.dateSettings=t;var n=new Date(t.minTime);var r=new Date(t.maxTime);e(".optionContainer.dates .year").empty();e(".optionContainer.dates .year").append('<option value="">all</option>');for(var i=n.getFullYear();i<=r.getFullYear();i++){e(".optionContainer.dates .year").append('<option value="'+i+'">'+i+"</option>")}},addColumn:function(t,n){var r=this.at.getActions(this.path);this.path.push(r[0]);var i=new App.Column({action:t,params:n,index:this.columns.length,path:this.path.slice(0),columnActions:r,nodeName:r[0],maxTime:this.dateSettings.maxTime,minTime:this.dateSettings.minTime,account:this.account});e(i).on("Ready",e.proxy(this.displayColumn,this,[this.columns.length]));e(i).on("Updated",e.proxy(this.updatedColumn,this));e(i).on("NewColumn",e.proxy(this.newColumnRequest,this));e(i).on("Closing",e.proxy(this.closingColumn,this));e(i).on("DataReceived",e.proxy(this.columnDataRecieved,this));e(i).on("RefreshingData",e.proxy(this.updatePath,this));this.columns.push(i)},updatedColumn:function(e){this.adjustColumnHeight()},updatePath:function(e,t,n){if(n!=this.path[t+1]){this.path[t+1]=n;if(this.columns.length>t)this.removeColumns(t+1)}},columnDataRecieved:function(t,n){if(n>0){e("#Column"+(n-1)+" .loading").hide();e("#Column"+(n-1)+" .resultContainer").eq(this.activeRow).children(".arrow").fadeIn()}},newColumnRequest:function(t,n,r,i,s){if(this.columns[n+1]){if(this.columns.length>n+1){this.removeColumns(n+2);console.log("NEWCOL",n,r,i);if(this.path[n+2]!=r){r=this.columns[n+1].action;i.count=this.columns[n+1].params.count;if(this.columns[n+1].params.start&&!i.start)i.start=this.columns[n+1].params.start;if(this.columns[n+1].params.end&&!i.end)i.end=this.columns[n+1].params.end}}e(this.columns[n+1].colName+" .loader").fadeIn();this.columns[n+1].updateAll(r,i)}else{this.addColumn(r,i)}this.activeRow=s},displayColumn:function(t,r){var i=t[0];if(this.columns.length>0){e("#loader").fadeOut()}var s=this.columns[i].element;var o=i*this.columns[i].width;this.totalColWidth+=this.columns[i].width;e(s).css("left",o-80);e(s).hide().fadeIn(300,e.proxy(function(){if(this.totalColWidth>e(n).width()){var t=this.totalColWidth-e(n).width();e(".columnContainer").animate({scrollLeft:t},300)}},this));e(s).css("left",o);this.adjustColumnHeight();this.activeColumn=i},removeColumns:function(e){if(this.columns.length>e){var t=(this.columns.length-e)*100;for(var n=this.columns.length-1;n>=e;n--){this.removeColumn(n,t-n*100);this.path.pop()}}if(e-1>=0){this.columns[e-1].removeHighlight()}},removeColumn:function(t,n){e(this.columns[t].element).delay(n).fadeOut(300,e.proxy(function(){this.columns[t].destroy();this.columns.splice(t,1)},this))},closingColumn:function(e,t){this.removeColumns(t)},adjustColumnHeight:function(t){var r=0;var i=0;r=e(n).height()-e("header").outerHeight();e(".columnContainer").css("height",r);var s=e(".column");e(".column").css("height","");for(var o=0;o<s.length;o++){if(e(s[o]).height()>i)i=e(s[o]).height();var u=r-e(s[o]).children(".colHeader").height()-parseInt(e(s[o]).children(".colHeader").css("padding-left"))*2;e(s[o]).children(".scrollContainer").css("height",u)}if(i<r)i=r;e(".column").css("height",r)},handleResize:function(e){this.adjustColumnHeight()},destroy:function(){this.removeColumns(0)}};return i}(jQuery,document,window,Utils);App.HTMLFactory=function(e,t,n,r){function o(){console.log("HTML FACTORY INIT")}var i=[31,28,31,30,31,30,31,31,30,31,30,31];var s=["January","February","March","April","May","June","July","August","September","October","November","December"];o.prototype={generateNoResults:function(){noResults=e("#template .noresults").eq(0).clone();return noResults},generateColumn:function(){},generateRow:function(t,n,r){newRow=e("#template .resultContainer").eq(0).clone();var o=e(newRow).children(".bar");e(newRow).children(".tally").text(r.count);if(t=="contacts"){e(newRow).find(".title span").text(r.name);e(newRow).find(".title i").addClass("fa-user");e(newRow).children("input").val(r.email)}else if(t=="dates"){var u,a;if(n.count.toUpperCase()==="MONTH"){u=new Date(r.year,r.month-1,1,0,0,0,0);a=new Date(r.year,r.month-1,i[r.month-1],23,59,59,0);e(newRow).find(".title>span").text(s[r.month-1]+", "+r.year)}else if(n.count.toUpperCase()==="DAY"){u=new Date(r.year,r.month-1,r.day,0,0,0,0);a=new Date(r.year,r.month-1,r.day,23,59,59,999);e(newRow).find(".title>span").text(s[r.month-1]+" "+r.day+", "+r.year)}e(newRow).find(".title>i").addClass("fa-calendar");e(newRow).children("input").val(u.getTime()/1e3+"-"+a.getTime()/1e3)}else if(t=="emails"){var f=new Date;f.setTime(r.date.utc*1e3);e(newRow).find(".title>span").text(f.toLocaleTimeString()+" "+r.subject);e(newRow).children(".title").attr("title",r.subject);e(newRow).children("input").val(r.id);e(newRow).find(".title i").addClass("fa-envelope")}else if(t=="words"){e(newRow).find(".title span").text(r.word);e(newRow).find(".title i").addClass("fa-file-word-o");e(newRow).children("input").val(r.word)}return newRow},generateEmail:function(t,n){newEmail=e("#template .emailContainer").eq(0).clone();var r=new Date;r.setTime(t.date.utc*1e3);newEmail.children(".subjectContainer").text(t.subject);newEmail.children(".date").text(t.date.date);newEmail.find(".fromContainer .name").text(t.contacts.from[0].name);newEmail.find(".fromContainer .email").text(t.contacts.from[0].email);if(t.contacts.from[0].email==n.left||t.contacts.from[0].email==n.right){newEmail.find(".fromContainer .contact").eq(0).addClass("found")}if(t.contacts.to){for(var i=0;i<t.contacts.to.length;i++){newEmail.children(".toContainer").append(this.generateContact(t.contacts.to[i]));if(t.contacts.to[i].email==n.left||t.contacts.to[i].email==n.right){newEmail.find(".toContainer .contact").eq(i).addClass("found")}}}if(t.contacts.cc){for(var s=0;s<t.contacts.cc.length;s++){newEmail.children(".ccContainer").append(this.generateContact(t.contacts.cc[s]));console.log(t.contacts.cc[s].email,n.observer);if(t.contacts.cc[s].email==n.left||t.contacts.cc[s].email==n.right||t.contacts.cc[s].email==n.observer){newEmail.find(".ccContainer .contact").eq(s).addClass("found")}}}else{newEmail.children(".ccContainer").hide()}if(t.contacts.bcc){for(var o=0;o<t.contacts.bcc.length;o++){newEmail.children(".bccContainer").append(this.generateContact(t.contacts.bcc[o]));if(t.contacts.bcc[o].email==n.left||t.contacts.bcc[o].email==n.right||t.contacts.bcc[o].email==n.observer){newEmail.find(".bccContainer .contact").eq(o).addClass("found")}}}else{newEmail.children(".bccContainer").hide()}if(t.body)newEmail.find(".bodyContainer .bodyContent").html(t.body.replace(/(?:\r\n|\r|\n)/g,"<br />"));return newEmail},generateContact:function(t){var n=e("#template .emailContainer .contact").eq(0).clone();if(t.name!=="null"){n.children(".name").text(t.name);n.children(".email").text("<"+t.email+">")}else{n.children(".name").text("<"+t.email+">");n.children(".email").hide()}return n},generateDIV:function(t,n){var r=e("<div></div>");if(t.length){for(var i=0;i<t.length;i++){r.addClass(t[i])}}r.html(n);return r},destroy:function(){}};return o}(jQuery,document,window,Utils);App.MinezyController=function(e,t,n,r){function i(t){console.log("MINEZY INIT");this.accounts={};this.account=undefined;this.progressTimer=0;this.tmpcount=0;e(n).on("mediaQueryChange",e.proxy(this.handleMediaQueryChange,this));e(n).resize(e.proxy(this.handleResize,this));if(!r.isTouch()){e(n).scroll(e.proxy(this.handleScroll,this))}else{e(n).on("touchmove",e.proxy(this.handleScroll,this))}this.dateSettings={};this.API=new App.API;this.account=100;this.API.getData(0,"accounts",{},e.proxy(this.checkAccount,this));e(".info.about .button").on("click",e.proxy(this.showInfo,this))}i.prototype={checkAccount:function(t){var n=t.accounts.account;for(var r=0;r<n.length;r++){if(n[r].id==e.cookie("account")){this.account=e.cookie("account")}}if(this.account>0){this.loadAccount()}else{this.showSettings()}},initAccounts:function(){e("#account_id").empty();for(var t=0;t<this.accounts.length;t++){var n="";if(this.account==this.accounts[t].id)n=" selected";e("#account_id").append('<option value="'+this.accounts[t].id+'" '+n+">"+this.accounts[t].account+"</option>")}},showInfo:function(){e(".siteOverlay").fadeIn(500);setTimeout(e.proxy(function(){console.log("here");e("section.admin.info").removeClass("hide")},this),100);e("section.admin.info .closeButton").on("click",e.proxy(this.hideInfo,this));e("section.admin.info .button.ok").on("click",e.proxy(this.hideInfo,this))},showSettings:function(t){e(".siteOverlay").fadeIn(500);setTimeout(e.proxy(function(){console.log("here");e("section.admin").removeClass("hide")},this),100);e("section.admin .closeButton,section.admin .button.cancel").on("click",e.proxy(this.hideSettings,this));e("section.admin .button.ok").on("click",e.proxy(this.saveSettings,this));e("section.admin .filename").hide();e(":file").change(e.proxy(function(t){e(".filename").fadeIn();e(".filename>span").text(t.currentTarget.files[0].name);e(".button.ok>i").removeClass("fa-check");e(".button.ok>i").addClass("fa-upload");e(".button.ok>span").text("Upload");e("select.databases").prop("disabled","disabled");e(".dbSelect").addClass("disabled");e("section.admin .button.ok").off("click");e("section.admin .button.ok").on("click",e.proxy(this.uploadFile,this))},this));this.API.getData(0,"accounts",{},e.proxy(this.getAccounts,this))},uploadFile:function(t){e("section.admin .button.ok").off("click");e("section.admin .button.ok").addClass("disabled");e(".button.ok>span").text("Uploading");e(".button.ok>i").removeClass("fa-upload");e(".button.ok>i").addClass("fa-refresh");e(".button.ok>i").addClass("rotating");e("section.admin .progressBar").hide();e("section.admin .progressBar").slideDown();e("section.admin .progressBar>.bar").width(0);e("section.admin .progressBar>span").text("0%");console.log(e("#uploadFile").ajaxForm());e("#uploadFile").ajaxSubmit({beforeSend:function(){var t="0%";e("section.admin .progressBar>.bar").width(t);e("section.admin .progressBar>span").html(t);console.log("BEGIN UPLOAD")},uploadProgress:function(t,n,r,i){var s=i+"%";e("section.admin .progressBar>.bar").width(s);e("section.admin .progressBar>span").html(s);console.log(i)},success:function(){var t="100%";e("section.admin .progressBar>.bar").width(t);e("section.admin .progressBar>span").html(t)},complete:e.proxy(function(t){if(t.responseText){e("section.admin .progressBar>.bar").width(0);e("section.admin .progressBar>span").text("0%");e(".button.ok>span").text("Processing");this.API.getData(0,"new_account",{file:t.responseText},e.proxy(this.startProcessing,this))}},this)})},startProcessing:function(t){e.cookie("account",t.account,{expires:365,path:"/"});this.account=t.account;this.tmpcount=0;this.progressTimer=setInterval(e.proxy(function(){this.API.getData(0,"new_account/progress",{},e.proxy(this.updateProcessingProgress,this))},this),1e3)},updateProcessingProgress:function(t){var n=this.tmpcount+"%";e("section.admin .progressBar>.bar").width(n);e("section.admin .progressBar>span").html(n);if(this.tmpcount==100){clearInterval(this.progressTimer);this.API.getData(0,"accounts",{},e.proxy(this.getAccounts,this));this.hideSettings()}this.tmpcount+=10},hideInfo:function(){e("section.admin.info .closeButton,section.admin .button.cancel").off("click");e("section.admin.info .button.ok").off("click");e("section.admin.info").addClass("hide");setTimeout(e.proxy(function(){e(".siteOverlay").fadeOut(500);this.resetSettings()},this),300)},hideSettings:function(){e("section.admin .closeButton,section.admin .button.cancel").off("click");e("section.admin .button.ok").off("click");e("section.admin").addClass("hide");e(":file").off("change");setTimeout(e.proxy(function(){e(".siteOverlay").fadeOut(500);this.resetSettings()},this),300)},resetSettings:function(){e("section.admin .button.ok>i").removeClass();e("section.admin .button.ok>i").addClass("fa fa-check");e(".button.ok>span").text("OK");e("section.admin .progressBar").slideUp();e("section.admin select.databases").prop("disabled",false);e("section.admin .dbSelect").removeClass("disabled")},saveSettings:function(){this.account=e("#account_id").val();e.cookie("account",this.account,{expires:365,path:"/"});this.hideSettings();this.loadAccount()},getAccounts:function(e){this.accounts=e.accounts.account;this.initAccounts()},loadAccount:function(){if(this.colManager){this.colManager.destroy();delete this.colManager}this.colManager=new App.ColumnController(this.account);this.API.getData(this.account,"dates/range",{},e.proxy(this.getDateRange,this))},getDateRange:function(e){var t=new Date(e.dates.range.first.year,e.dates.range.first.month,e.dates.range.first.day,0,0,0,0);var n=new Date(e.dates.range.last.year,e.dates.range.last.month,e.dates.range.last.day,0,0,0,0);this.dateSettings.minTime=t.getTime();this.dateSettings.maxTime=n.getTime();this.colManager.setDates(this.dateSettings);this.colManager.addColumn("contacts",{limit:20})},handleScroll:function(e){},handleResize:function(e){},destroy:function(){}};return i}(jQuery,document,window,Utils);App.NavController=function(e,t,n,r,i){"use strict";function s(e,t){console.log("NAV CONTROLLER INIT");this.currentPage="";this.router=new i.Router;this.pageNotFound=false;this.createRoutes();this.pageController=this.loadController()}s.prototype={createRoutes:function(){this.router.addRoutes([{path:"/app",controller:"MinezyController"}])},loadController:function(){if(e("#404").length){this.pageNotFound=true}var t={};if(!this.pageNotFound){t=this.router.route()}if(t){return t.createController()}else{throw new Error("Undefined route: "+n.location.pathname)}},destroy:function(){}};return s}(jQuery,document,window,App,Utils);App.API=function(e,t,n,r){function i(){this.api_root="http://"+n.location.hostname+":5000";this.api_version=1;this.current_call=null}i.prototype={getData:function(t,n,r,i){if(this.current_call){this.current_call.abort();delete this.current_call}this.current_call=e.ajax({type:"GET",url:this.constructURL(t,n,r),data:r,dataType:"json"}).done(e.proxy(function(e){i(e)},this))},constructURL:function(e,t,n){var r="";if(e){r=e+"/"}console.log(e,r,t);var i=this.api_root+"/"+this.api_version+"/"+r+t;console.log(i);return i},destroy:function(){}};return i}(jQuery,document,window,Utils);App.ActionTree=function(e,t,n,r){function s(){}var i={root:{contacts:{"contacts-left":{"dates-to":{"dates-day":{"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false},"contacts-right":{"dates-to":{"dates-day":{"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}},words:{"dates-day":{"emails-list":{"emails/meta":false},"contacts-left":{"emails-list":{"emails/meta":false}}},"emails-list":{"emails/meta":false}}},words:{"dates-day":{"emails-list":{"emails/meta":false},"contacts-left":{"emails-list":{"emails/meta":false}}},"emails-list":{"emails/meta":false}},dates:{"dates-day":{"emails-list":{"emails/meta":false},"contacts-left":{"emails-list":{"emails/meta":false}}},"contacts-left":{"dates-day":{"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false},"contacts-right":false},"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}},dates:{contacts:{"contacts-left":{"dates-day":{"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false},"contacts-right":{"dates-day":{"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}}},"dates-day":{"contacts-left":{"emails-list":{"emails/meta":false},"contacts-right":false},"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}},"dates-day":{contacts:{"contacts-left":{"emails-list":{"emails/meta":false},"contacts-right":false},"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}}},words:{dates:{"dates-day":{"emails-list":{"emails/meta":false},"contacts-left":{"emails-list":{"emails/meta":false}}},"emails-list":{"emails/meta":false}},"emails-list":{"emails/meta":false}}}};s.prototype={getActions:function(e){var t=e.slice(0);var n=this.traverse(i,t);var r=[];for(var s in n){r.push(s)}t=null;return r},traverse:function(e,t){var n;if(t.length==1){return e[t.shift()]}n=t.shift();return this.traverse(e[n],t)},destroy:function(){}};return s}(jQuery,document,window,Utils);Utils.Route=function(){"use strict";function e(e,t){this.path=e;this.controller=t}e.prototype={match:function(e){var t=new RegExp("^/?"+this.path+"/?$");var n=e.match(t);if(n!==null){return true}return false},createController:function(e){if(typeof App[this.controller]!=="undefined"){return new App[this.controller](e)}else{throw new Error("Controller cannot be created! ("+this.controller+")")}}};return e}();Utils.Router=function(e,t){"use strict";function n(e){this.options=e||{};this.routes=[]}n.prototype={addRoute:function(e,n){var r=new t.Route(e,n);this.routes.push(r)},addRoutes:function(t){e.each(t,e.proxy(function(e,t){this.addRoute(t.path,t.controller)},this))},getManualRoute:function(t){var n=false;e.each(this.routes,function(e,r){if(r.controller===t){n=r}});return n},route:function(){var t=false;e.each(this.routes,function(e,n){if(n.match(window.location.pathname)&&!t){t=n}});return t}};return n}(jQuery,Utils)
